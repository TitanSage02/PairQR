# 1) HTTPS
api.pairqr.app {
  encode gzip
  reverse_proxy pairqr:3000
  header {
    Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    X-Content-Type-Options "nosniff"
    Referrer-Policy "no-referrer"
  }
}

# 2) HTTP 
http://api.pairqr.app {
  route /health {
    respond "ok" 200
  }
  redir https://api.pairqr.app{uri}
}

# 3) RH Agent API
api-rh.pairqr.com {
    # Reverse proxy vers FastAPI (port 8000)
    reverse_proxy localhost:8000

    # Limite d'upload pour CV (5MB)
    request_body {
      max_size 5MB
    }

    # Headers de sécurité
    header {
        -Server
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        Referrer-Policy "strict-origin-when-cross-origin"
    }

    # Logs
    log {
        output file /var/log/caddy/rh-agent.log
        format console
    }

    # Automatic HTTPS (Let's Encrypt)
    tls {
        protocols tls1.2 tls1.3
    }
}